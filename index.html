<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <!-- Icône iOS (on ajoutera des PNG plus tard) -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>Budget – Enveloppes</title>
  <style>
    :root { --bg:#f6f7fb; --card:#fff; --ink:#0f172a; --muted:#667085; --ring:#e5e7eb; --accent:#2563eb; }
    *{ box-sizing:border-box } body{ margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--ink); background:var(--bg) }
    .wrap{ max-width:920px; margin:0 auto; padding:16px }
    .grid{ display:grid; grid-template-columns:1fr; gap:12px }
    @media(min-width:840px){ .grid{ grid-template-columns:1.2fr .8fr } }
    .card{ background:var(--card); border:1px solid var(--ring); border-radius:16px; padding:16px; box-shadow:0 2px 10px rgba(0,0,0,.04) }
    h1{ margin:8px 0 12px 0 } h2{ margin:0 0 10px 0; font-size:18px }
    input,select,button,textarea{ width:100%; padding:10px; border-radius:10px; border:1px solid var(--ring); font-size:16px; }
    button{ border:none; background:var(--accent); color:#fff; cursor:pointer }
    .row{ display:flex; gap:8px } .row>*{ flex:1 }
    .muted{ color:var(--muted); font-size:14px }
    .pill{ display:inline-block; padding:4px 8px; border-radius:999px; background:#eef2ff; color:#4338ca; font-size:12px }
    .table{ width:100%; border-collapse: collapse } .table th,.table td{ padding:8px; border-bottom:1px dashed #e5e7eb; text-align:left }
    .bar{ height:8px; background:#e5e7eb; border-radius:999px; overflow:hidden }
    .bar>i{ display:block; height:100%; background:#22c55e; width:0% }
    .right{ text-align:right }
    .actions{ display:flex; gap:8px; align-items:center }
    .danger{ background:#ef4444 }
    .ghost{ background:#111827; color:#fff }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Budget (MVP enveloppes)</h1>
    <p class="muted">Mode offline. Données dans ton navigateur. Export/Import JSON possibles.</p>

    <div class="grid">
      <!-- Colonne gauche -->
      <div class="grid-col">

        <div class="card">
          <h2>1) Paramètres mensuels</h2>
          <div class="row">
            <input id="salary" type="number" inputmode="decimal" placeholder="Salaire mensuel (DZD)" />
            <button id="saveSalary">Enregistrer</button>
          </div>
          <p class="muted">Valeur actuelle : <strong id="currentSalary">—</strong></p>
        </div>

        <div class="card">
          <h2>2) Enveloppes (catégories)</h2>
          <div class="row">
            <input id="catName" placeholder="Nom (ex: Courses)" />
            <input id="catBudget" type="number" inputmode="decimal" placeholder="Budget (DZD)" />
            <button id="addCat">Ajouter</button>
          </div>
          <p class="muted">Astuce : commence par tes enveloppes fixes (Courses, Voyages, Enfants, Maison, Véhicule, Épargne, Perso, Maman, Scolaire…).</p>

          <table class="table" id="catsTable">
            <thead>
              <tr><th>Catégorie</th><th class="right">Budget</th><th class="right">Dépensé</th><th class="right">Restant</th><th></th></tr>
            </thead>
            <tbody id="catsBody"></tbody>
          </table>
          <p><span class="pill">Total catégories : <span id="catsTotal">0</span> DZD</span></p>
        </div>

        <div class="card">
          <h2>3) Dépenses</h2>
          <div class="row">
            <select id="txCat"></select>
            <input id="txAmount" type="number" inputmode="decimal" placeholder="Montant (DZD)" />
          </div>
          <div class="row">
            <input id="txNote" placeholder="Note (facultatif)" />
            <input id="txDate" type="date" />
          </div>
          <div class="row">
            <button id="addTx">Ajouter dépense</button>
            <button id="clearTx" class="danger">Vider l'historique</button>
          </div>

          <table class="table" id="txTable">
            <thead>
              <tr><th>Date</th><th>Catégorie</th><th>Note</th><th class="right">Montant</th></tr>
            </thead>
            <tbody id="txBody"></tbody>
          </table>
        </div>

      </div>

      <!-- Colonne droite -->
      <div class="grid-col">
        <div class="card">
          <h2>Dashboard</h2>
          <p>Salaire : <strong id="dashSalary">—</strong></p>
          <p>Total budgets : <strong id="dashCats">—</strong></p>
          <p>Total dépensé : <strong id="dashSpent">—</strong></p>
          <p>Épargne théorique (Salaire − Dépenses) : <strong id="dashSave">—</strong></p>
          <div class="bar"><i id="barSpent"></i></div>
                    <div id="catBars"></div>

          <p class="muted">La barre montre le % dépensé vs salaire.</p>
          <div class="actions">
            <button id="exportBtn" class="ghost">Exporter JSON</button>
            <input id="importFile" type="file" accept="application/json" />
          </div>
        </div>

        <div class="card">
          <h2>Raccourcis</h2>
          <button id="seedDz">Précharger enveloppes DZ (exemple)</button>
          <p class="muted">Tu pourras les modifier/supprimer ensuite.</p>
        </div>
      </div>
    </div>
  </div>

  <script src="./db.js"></script>
  <script src="./app.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => navigator.serviceWorker.register("./sw.js"));
    }
  </script>

  </script>
</body>
</html>
